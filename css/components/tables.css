/**
 * Table Component Styles
 * Responsive data tables
 */

.table-responsive {
    overflow-x: auto;
    background: var(--card);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-md);
}

table {
    width: 100%;
    border-collapse: collapse;
    min-width: 600px;
}

thead {
    position: sticky;
    top: 0;
    z-index: 1;
}

th {
    background: #F9FAFB;
    color: var(--text-light);
    font-weight: 600;
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

th, td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid var(--border-light);
}

tbody tr {
    transition: background var(--transition-fast);
}

tbody tr:hover {
    background: #FAFAFA;
}

tbody tr:last-child td {
    border-bottom: none;
}

/* Delete Button in Table */
.delete-btn {
    background: none;
    border: none;
    color: #ccc;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 5px;
    border-radius: var(--border-radius-xs);
    transition: all var(--transition-fast);
}

.delete-btn:hover {
    color: var(--danger);
    background: rgba(211, 47, 47, 0.1);
}

/* Table Card Header */
.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.table-header h3 {
    margin: 0;
    font-size: 1.1rem;
    color: var(--text);
}

.reset-btn {
    color: var(--danger);
    background: none;
    border: none;
    cursor: pointer;
    font-size: var(--font-size-sm);
    padding: 8px 12px;
    border-radius: var(--border-radius-sm);
    transition: background var(--transition-fast);
}

.reset-btn:hover {
    background: rgba(211, 47, 47, 0.1);
}

/* Empty State */
.table-empty {
    text-align: center;
    padding: 40px;
    color: var(--text-light);
}

.table-empty i {
    font-size: 3rem;
    margin-bottom: 15px;
    color: var(--border);
}

/* Ledger Edit Modal */
.ledger-edit-modal {
    position: fixed;
    inset: 0;
    z-index: 1100;
}

.ledger-edit-modal.hidden {
    display: none;
}

.ledger-edit-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(15, 23, 42, 0.45);
    backdrop-filter: blur(4px);
}

.ledger-edit-dialog {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--card);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
    width: 100%;
    max-width: 640px;
    padding: 20px 24px;
    max-height: calc(100vh - 40px);
    overflow-y: auto;
}

.ledger-edit-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
}

.ledger-edit-header h4 {
    margin: 0;
    font-size: 1.05rem;
    color: var(--text);
}

.ledger-edit-close {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--text-light);
    font-size: 1.1rem;
    padding: 4px;
    border-radius: var(--border-radius-xs);
}

.ledger-edit-close:hover {
    background: rgba(148, 163, 184, 0.15);
}

.ledger-edit-form {
    margin-top: 4px;
}

.ledger-edit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px 16px;
}

.ledger-edit-form .form-group.hidden {
    display: none;
}

.ledger-edit-hint {
    margin: 12px 0 0;
    font-size: 0.8rem;
    color: var(--text-light);
}

.ledger-edit-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 16px;
}

@media (max-width: 640px) {
    .ledger-edit-dialog {
        max-width: calc(100% - 24px);
        padding: 16px 16px 18px;
        top: 50%;
        transform: translate(-50%, -50%);
        max-height: calc(100vh - 24px);
    }
}

/* Description Cell */
.description-cell {
    max-width: 200px;
    min-width: 100px;
    position: relative;
}

.description-text {
    display: inline-block;
    color: var(--text);
    font-size: var(--font-size-sm);
    line-height: 1.4;
    word-wrap: break-word;
    max-width: 100%;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    line-height: 1.4;
    max-height: 2.8em; /* 2 lines */
}

.description-icon {
    background: none;
    border: none;
    color: var(--primary);
    font-size: 1.1rem;
    cursor: pointer;
    padding: 5px 8px;
    border-radius: var(--border-radius-xs);
    transition: all var(--transition-fast);
    display: none; /* Hidden by default, shown on smaller screens */
    align-items: center;
    justify-content: center;
    margin-left: 8px;
    vertical-align: middle;
}

.description-icon.always-visible {
    display: inline-flex; /* Show icon when text is truncated */
}

.description-icon:hover {
    color: var(--info);
    background: rgba(33, 150, 243, 0.1);
    transform: scale(1.1);
}

.description-icon:active {
    transform: scale(0.95);
}

/* Row highlighting when tooltip is open */
tbody tr.row-highlighted {
    background: rgba(33, 150, 243, 0.08) !important;
    box-shadow: inset 3px 0 0 var(--primary);
}

tbody tr.row-highlighted:hover {
    background: rgba(33, 150, 243, 0.12) !important;
}

/* Responsive: Show icon on smaller screens, hide text */
@media (max-width: 1200px) {
    .description-text {
        display: none;
    }
    
    .description-icon {
        display: inline-flex;
    }
    
    .description-cell {
        text-align: center;
        width: 60px;
        min-width: 60px;
        max-width: 60px;
    }
}

/* On very small screens, always show icon */
@media (max-width: 768px) {
    .description-text {
        display: none;
    }
    
    .description-icon {
        display: inline-flex;
    }
    
    .description-cell {
        text-align: center;
        width: 50px;
        min-width: 50px;
        max-width: 50px;
    }
}

/* Description Tooltip */
.description-tooltip {
    background: var(--card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
    min-width: 250px;
    max-width: 400px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 10000;
    animation: tooltipFadeIn 0.2s ease-out;
    position: fixed;
}

@keyframes tooltipFadeIn {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tooltip-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    border-bottom: 1px solid var(--border-light);
    background: #F9FAFB;
    border-radius: var(--border-radius) var(--border-radius) 0 0;
}

.tooltip-header span {
    font-weight: 600;
    font-size: var(--font-size-sm);
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
}

.tooltip-header i {
    color: var(--primary);
}

.tooltip-close {
    background: none;
    border: none;
    color: var(--text-light);
    cursor: pointer;
    padding: 4px;
    border-radius: var(--border-radius-xs);
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
}

.tooltip-close:hover {
    color: var(--danger);
    background: rgba(211, 47, 47, 0.1);
}

.tooltip-content {
    padding: 15px;
    color: var(--text);
    font-size: var(--font-size-sm);
    line-height: 1.5;
    word-wrap: break-word;
    white-space: pre-wrap;
}

/* Mobile Card - Hidden on desktop, shown only on mobile */
.mobile-card {
    display: none !important;
}

/* Desktop: ensure table cells are visible */
@media (min-width: 769px) {
    #ledgerTable td {
        display: table-cell;
    }
    
    #ledgerTable .mobile-card {
        display: none !important;
    }
}

/* Mobile Styles - Apple-style Transaction Cards */
@media (max-width: 768px) {
    .description-tooltip {
        min-width: 200px;
        max-width: calc(100vw - 32px);
        max-height: 250px;
        left: 16px !important;
        right: 16px !important;
        width: calc(100vw - 32px);
    }

    /* Hide the regular table structure on mobile */
    #ledgerTable {
        min-width: 0;
        border: 0;
        background: transparent;
    }

    #ledgerTable thead {
        display: none;
    }

    #ledgerTable tbody {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    /* Hide all table cells on mobile */
    #ledgerTable td {
        display: none !important;
    }

    /* Show mobile card on mobile */
    #ledgerTable .mobile-card {
        display: block !important;
        width: 100%;
    }

    /* Apple-style Transaction Card Container */
    #ledgerTable tr.ledger-row {
        display: block;
        background: transparent;
        border: none;
        padding: 0;
        margin: 0;
    }

    /* Card Base Styles */
    .mobile-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        padding: 16px;
        box-shadow: 
            0 2px 8px rgba(0, 0, 0, 0.04),
            0 4px 24px rgba(0, 0, 0, 0.06);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
    }

    /* Card Header */
    .mobile-card .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
    }

    .mobile-card .card-type {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .mobile-card .type-icon {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        color: white;
    }

    .mobile-card .type-label {
        font-weight: 600;
        font-size: 14px;
        letter-spacing: 0.02em;
    }

    .mobile-card .card-date {
        color: #8E8E93;
        font-size: 14px;
    }

    /* Type-specific icon colors */
    .mobile-card .type-icon-buy { background: #2E7D32; }
    .mobile-card .type-label-buy { color: #2E7D32; }

    .mobile-card .type-icon-sell { background: #FF3B30; }
    .mobile-card .type-label-sell { color: #1976D2; }

    .mobile-card .type-icon-process { background: #F9A825; }
    .mobile-card .type-label-process { color: #E65100; }

    .mobile-card .type-icon-income { background: #2E7D32; }
    .mobile-card .type-label-income { color: #2E7D32; }

    .mobile-card .type-icon-expense { background: #D32F2F; }
    .mobile-card .type-label-expense { color: #D32F2F; }

    .mobile-card .type-icon-loan { background: #7B1FA2; }
    .mobile-card .type-label-loan { color: #7B1FA2; }

    .mobile-card .type-icon-adjustment { background: #0288D1; }
    .mobile-card .type-label-adjustment { color: #0288D1; }

    /* Amount Display */
    .mobile-card .card-amount {
        font-size: 32px;
        font-weight: 600;
        margin: 12px 0;
        line-height: 1.2;
    }

    .mobile-card .card-amount.positive {
        color: #2E7D32;
    }

    .mobile-card .card-amount.negative {
        color: #D32F2F;
    }

    .mobile-card .card-amount.neutral {
        color: #E65100;
        font-size: 26px;
    }

    /* Divider */
    .mobile-card .card-divider {
        height: 1px;
        background: #E5E5EA;
        margin: 12px 0;
    }

    /* Detail Rows */
    .mobile-card .card-row {
        display: flex;
        justify-content: space-between;
        font-size: 15px;
        padding: 6px 0;
    }

    .mobile-card .card-details {
        justify-content: flex-end;
        color: var(--text);
    }

    .mobile-card .card-stock {
        color: #6E6E73;
    }

    .mobile-card .card-stock .text-negative {
        color: #FF3B30;
        font-weight: 500;
    }

    /* Actions Row */
    .mobile-card .card-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 4px;
    }

    .mobile-card .card-btn {
        border: none;
        background: none;
        font-size: 15px;
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        font-family: inherit;
        transition: background 0.2s ease;
    }

    .mobile-card .card-btn-info {
        color: #007AFF;
    }

    .mobile-card .card-btn-info:hover,
    .mobile-card .card-btn-info:active {
        background: rgba(0, 122, 255, 0.1);
    }

    .mobile-card .card-btn-delete {
        color: #8E8E93;
    }

    .mobile-card .card-btn-delete:hover,
    .mobile-card .card-btn-delete:active {
        background: rgba(0, 0, 0, 0.05);
        color: #FF3B30;
    }

    /* Type-specific card backgrounds */
    #ledgerTable tr.ledger-row-buy .mobile-card {
        background: linear-gradient(135deg, rgba(232, 245, 233, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);
    }

    #ledgerTable tr.ledger-row-sell .mobile-card {
        background: linear-gradient(135deg, rgba(227, 242, 253, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);
    }

    #ledgerTable tr.ledger-row-process .mobile-card {
        background: linear-gradient(135deg, rgba(255, 248, 225, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);
    }

    #ledgerTable tr.ledger-row-income .mobile-card {
        background: linear-gradient(135deg, rgba(232, 245, 233, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);
    }

    #ledgerTable tr.ledger-row-expense .mobile-card {
        background: linear-gradient(135deg, rgba(255, 235, 238, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);
    }

    #ledgerTable tr.ledger-row-loan .mobile-card {
        background: linear-gradient(135deg, rgba(243, 229, 245, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);
    }
    
    #ledgerTable tr.ledger-row-adjustment .mobile-card {
        background: linear-gradient(135deg, rgba(227, 242, 253, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);
    }

    /* Empty state styling */
    #ledgerTable .table-empty {
        display: flex !important;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px 20px;
        background: var(--card);
        border-radius: 16px;
    }

    /* Row highlight for description tooltip */
    #ledgerTable tr.ledger-row.row-highlighted .mobile-card {
        box-shadow: 
            0 0 0 2px #007AFF,
            0 4px 24px rgba(0, 122, 255, 0.2);
    }
}
